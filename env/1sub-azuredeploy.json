{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
  "parameters": {
    
    "servers_dbsrv_mysqldbserver_xxxxxxx_createMode": {
      "defaultValue": "PointInTimeRestore",
      "type": "SecureString"
    },

    "administratorLogin": {
      "type": "string",
      "defaultValue": "mrmubi99"
    },
    "administratorLoginPassword": {
      "type": "securestring",
      "defaultValue": "Microsoft1999"
    },
    "sites_APP_xxxx_xxxx_xxxxx_name": {
      "defaultValue": "APP-xxxx-xxxx-xxxxx",
      "type": "String"
    },
    "components_AI_xxxx_xxxx_xxxx_name": {
      "defaultValue": "AI-xxxx-xxxx-xxxx",
      "type": "String"
    },
    "slots_prd_name": {
      "defaultValue": "prd",
      "type": "String"
    },
    "serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name": {
      "defaultValue": "APP-PLAN-xxxx-xxxx-xxxxx",
      "type": "String"
    },
    "config_web_name": {
      "defaultValue": "web",
      "type": "String"
    },
    "servers_dbsrv_mysqldbserver_xxxxxxx_name": {
      "defaultValue": "dbsrv-mysqldbserver-xxxxxxx",
      "type": "String"
    },
    "config_web_name_1": {
      "defaultValue": "web",
      "type": "String"
    },
    "certificateOrders_kerryfreshcom_name": {
      "defaultValue": "kerryfreshcom",
      "type": "String"
    },
    "alertrules_Failure_Anomalies___AI_xxxx_xxxx_xxxx_name": {
      "defaultValue": "Failure Anomalies - AI-xxxx-xxxx-xxxx",
      "type": "String"
    },
    "databases_sys_name": {
      "defaultValue": "sys",
      "type": "String"
    },
    "databases_mysql_name": {
      "defaultValue": "mysql",
      "type": "String"
    },
    "firewallRules_AllowAll_name": {
      "defaultValue": "AllowAll",
      "type": "String"
    },
    "configurations_sql_mode_name": {
      "defaultValue": "sql_mode",
      "type": "String"
    },
    "configurations_server_id_name": {
      "defaultValue": "server_id",
      "type": "String"
    },
    
    "configurations_character_set_server_name": {
      "defaultValue": "character_set_server",
      "type": "String"
    },

    "configurations_innodb_compression_failure_threshold_pct_name": {
      "defaultValue": "innodb_compression_failure_threshold_pct",
      "type": "String"
    }
  },
    "variables": {},
  "resources": [

    {
      "type": "Microsoft.DBforMySQL/servers",
      "sku": {
        "name": "B_Gen5_2",
        "tier": "Basic",
        "family": "Gen5",
        "capacity": 2
      },
      "name": "[parameters('servers_dbsrv_mysqldbserver_xxxxxxx_name')]",
      "apiVersion": "2017-12-01-preview",
      "location": "northeurope",
      "scale": null,
      "properties": {
        "storageProfile": {
          "storageMB": 51200,
          "backupRetentionDays": 7,
          "geoRedundantBackup": "Disabled"
        },
        "version": "5.7",
        "sslEnforcement": "Disabled",
        "administratorLogin": "[parameters('administratorLogin')]",
        "administratorLoginPassword": "[parameters('administratorLoginPassword')]"

      },
      "dependsOn": []
    },

    {
      "type": "Microsoft.DBforMySQL/servers/firewallRules",
      "name": "[concat(parameters('servers_dbsrv_mysqldbserver_xxxxxxx_name'), '/', parameters('firewallRules_AllowAll_name'))]",
      "apiVersion": "2017-12-01-preview",
      "scale": null,
      "properties": {
        "startIpAddress": "0.0.0.0",
        "endIpAddress": "255.255.255.255"
      },
      "dependsOn": [
        "[resourceId('Microsoft.DBforMySQL/servers', parameters('servers_dbsrv_mysqldbserver_xxxxxxx_name'))]"
      ]
    },


    {
      "type": "Microsoft.DBforMySQL/servers/databases",
      "name": "[concat(parameters('servers_dbsrv_mysqldbserver_xxxxxxx_name'), '/', parameters('databases_mysql_name'))]",
      "apiVersion": "2017-12-01-preview",
      "scale": null,
      "properties": {
        "charset": "latin1",
        "collation": "latin1_swedish_ci"
      },
      "dependsOn": [
        "[resourceId('Microsoft.DBforMySQL/servers', parameters('servers_dbsrv_mysqldbserver_xxxxxxx_name'))]"
      ]
    },


    {
      "type": "microsoft.insights/alertrules",
      "name": "[parameters('alertrules_Failure_Anomalies___AI_xxxx_xxxx_xxxx_name')]",
      "apiVersion": "2014-04-01",
      "location": "North Europe",
      "tags": {
        "hidden-link:/subscriptions/20f00f50-ebde-4d6c-803f-ec3680c38ef6/resourceGroups/RG_xxxx_xxxx_xxxx/providers/microsoft.insights/components/AI-xxxx-xxxx-xxxx": "Resource"
      },
      "scale": null,
      "properties": {
        "name": "[parameters('alertrules_Failure_Anomalies___AI_xxxx_xxxx_xxxx_name')]",
        "description": "",
        "isEnabled": true,
        "condition": {
          "odata.type": "Microsoft.Azure.Management.Insights.Models.ThresholdRuleCondition",
          "dataSource": {
            "odata.type": "Microsoft.Azure.Management.Insights.Models.RuleMetricDataSource",
            "resourceUri": "[resourceId('microsoft.insights/components', parameters('components_AI_xxxx_xxxx_xxxx_name'))]",
            "metricNamespace": null,
            "metricName": "advanced::A3108E3D-5E26-44CF-B232-783F5E20EF10::ewAiAEgAeQBwAGUAcgBpAG8AbgBBAHAAcABsAGkAYwBhAHQAaQBvAG4AUwBpAGQAIgA6AG4AdQBsAGwALAAiAEgAeQBwAGUAcgBpAG8AbgBTAHUAYgBqAGUAYwB0AFMAaQBkACIAOgBuAHUAbABsACwAIgBIAHkAcABlAHIAaQBvAG4ATwBiAHMAZQByAHYAZQByAFMAaQBkACIAOgBuAHUAbABsACwAIgBDAHUAcwB0AG8AbQBlAHIAQQBjAGMAbwB1AG4AdABJAGQAIgA6ACIAMAAwADAAMAAwADAAMAAwAC0AMAAwADAAMAAtADAAMAAwADAALQAwADAAMAAwAC0AMAAwADAAMAAwADAAMAAwADAAMAAwADAAIgAsACIAQQBwAHAAbABpAGMAYQB0AGkAbwBuAE4AYQBtAGUAIgA6AG4AdQBsAGwALAAiAEEAcABwAGwAaQBjAGEAdABpAG8AbgBJAGQAIgA6AG4AdQBsAGwALAAiAFAAcgBvAGYAaQBsAGUASQBkACIAOgAwACwAIgBXAGkAbgBkAG8AdwBTAGkAegBlAEkAbgBNAGkAbgB1AHQAZQBzACIAOgA2ADAALAAiAE0AZQB0AHIAaQBjAE4AYQBtAGUAIgA6ACIAIgAsACIAVABoAHIAZQBzAGgAbwBsAGQAIgA6ADIALgAwACwAIgBBAGwAZQByAHQAVABlAG0AcABsAGEAdABlAEkAZAAiADoAIgAiACwAIgBSAHUAbABlAEkAZAAiADoAIgAiACwAIgBSAHUAbABlAE4AYQBtAGUAIgA6ACIAIgAsACIAUgB1AGwAZQBEAGUAcwBjAHIAaQBwAHQAaQBvAG4AIgA6ACIAIgAsACIAUgBlAHMAbwB1AHIAYwBlAEkAZAAiADoAbgB1AGwAbAAsACIAUwB1AGIAcwBjAHIAaQBwAHQAaQBvAG4ASQBkACIAOgBuAHUAbABsACwAIgBBAGcAZwByAGUAZwBhAHQAZQBGAHUAbgBjAHQAaQBvAG4AIgA6ACIAIgAsACIAQwBvAG0AcABhAHIAaQBzAG8AbgBPAHAAZQByAGEAdABvAHIAIgA6ACIAewBcACIAQgBhAHMAZQBsAGkAbgBlAFQAaQBtAGUAcwBwAGEAbgBcACIAOgBcACIAMAAwADoANAAwADoAMAAwAFwAIgAsAFwAIgBJAG4AcwBpAGcAaAB0AHMAUwBlAHIAdgBpAGMAZQBMAGEAZwBcACIAOgBcACIAMAAwADoAMAAwADoAMAAwAFwAIgAsAFwAIgBCAHUAZgBmAGUAcgBUAGkAbQBlAFwAIgA6AFwAIgAwADAAOgAwADEAOgAwADAAXAAiACwAXAAiAEIAbABvAGIAUwB0AG8AcgBhAGcAZQBMAG8AZwBnAGkAbgBnAEUAbgBhAGIAbABlAGQAXAAiADoAZgBhAGwAcwBlACwAXAAiAFUAcwBlAHIAUwB1AHAAcAByAGUAcwBzAGkAbwBuAHMAXAAiADoAbgB1AGwAbAAsAFwAIgBQAHIAbwBmAGkAbABlAEkAZABcACIAOgAwACwAXAAiAEUAbQBhAGkAbABUAHkAcABlAFwAIgA6ADAALABcACIAUgBkAGQARgBhAGkAbAB1AHIAZQBzAFMAcABpAGsAZQBUAGgAcgBlAHMAaABvAGwAZABcACIAOgAzAC4AMAAsAFwAIgBSAGEAdwBQAHIAbwBhAGMAdABpAHYAZQBSAHUAbABlAEMAbwBuAGYAaQBnAFwAIgA6AG4AdQBsAGwAfQAiACwAIgBFAG4AYQBiAGwAZQBTAGUAbgBkAEUAbQBhAGkAbABUAG8AQwB1AHMAdABvAG0AIgA6AGYAYQBsAHMAZQAsACIAQwB1AHMAdABvAG0ARQBtAGEAaQBsAHMARQBuAGMAbwBkAGUAZAAiADoAIgAiACwAIgBFAG4AYQBiAGwAZQBTAGUAbgBkAEUAbQBhAGkAbABUAG8ATwB3AG4AZQByAHMAIgA6AGYAYQBsAHMAZQB9AA=="
          },
          "operator": "GreaterThan",
          "threshold": 2,
          "windowSize": "PT1H"
        },
        "action": {
          "odata.type": "Microsoft.Azure.Management.Insights.Models.RuleEmailAction",
          "sendToServiceOwners": true,
          "customEmails": []
        }
      },
      "dependsOn": [
        "[resourceId('microsoft.insights/components', parameters('components_AI_xxxx_xxxx_xxxx_name'))]"
      ]
    },
    {
      "type": "microsoft.insights/components",
      "kind": "web",
      "name": "[parameters('components_AI_xxxx_xxxx_xxxx_name')]",
      "apiVersion": "2015-05-01",
      "location": "northeurope",
      "tags": {},
      "scale": null,
      "properties": {
        "Application_Type": "web",
        "Flow_Type": null,
        "Request_Source": "IbizaWebAppExtensionCreate",
        "HockeyAppId": null,
        "SamplingPercentage": null
      },
      "dependsOn": []
    },
    {
      "type": "Microsoft.Web/serverfarms",
      "sku": {
        "name": "S1",
        "tier": "Standard",
        "size": "S1",
        "family": "S",
        "capacity": 1
      },
      "kind": "app",
      "name": "[parameters('serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name')]",
      "apiVersion": "2016-09-01",
      "location": "North Europe",
      "scale": null,
      "properties": {
        "name": "[parameters('serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name')]",
        "workerTierName": null,
        "adminSiteName": null,
        "hostingEnvironmentProfile": null,
        "perSiteScaling": false,
        "reserved": false,
        "targetWorkerCount": 0,
        "targetWorkerSizeId": 0
      },
      "dependsOn": []
    },
    {
      "type": "Microsoft.Web/sites",
      "kind": "app",
      "name": "[parameters('sites_APP_xxxx_xxxx_xxxxx_name')]",
      "apiVersion": "2016-08-01",
      "location": "North Europe",
      "scale": null,
      "properties": {
        "enabled": true,
        "hostNameSslStates": [
          {
            "name": "[concat(parameters('sites_APP_xxxx_xxxx_xxxxx_name'),'app-xxxx-xxxx-xxxxx.azurewebsites.net')]",
            "sslState": "Disabled",
            "virtualIP": null,
            "thumbprint": null,
            "toUpdate": null,
            "hostType": "Standard"
          },
          {
            "name": "[concat(parameters('sites_APP_xxxx_xxxx_xxxxx_name'),'app-xxxx-xxxx-xxxxx.scm.azurewebsites.net')]",
            "sslState": "Disabled",
            "virtualIP": null,
            "thumbprint": null,
            "toUpdate": null,
            "hostType": "Repository"
          }
        ],
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name'))]",
        "reserved": false,
        "siteConfig": null,
        "scmSiteAlsoStopped": false,
        "hostingEnvironmentProfile": null,
        "clientAffinityEnabled": true,
        "clientCertEnabled": false,
        "hostNamesDisabled": false,
        "containerSize": 0,
        "dailyMemoryTimeQuota": 0,
        "cloningInfo": null,
        "httpsOnly": false
      },
      "dependsOn": [
        "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name'))]"
      ]
    },





    {
      "type": "Microsoft.Web/sites/config",
      "name": "[concat(parameters('sites_APP_xxxx_xxxx_xxxxx_name'), '/', parameters('config_web_name'))]",
      "apiVersion": "2016-08-01",
      "location": "North Europe",
      "scale": null,
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_APP_xxxx_xxxx_xxxxx_name'))]"
      ]
    },
    {
      "type": "Microsoft.Web/sites/slots",
      "kind": "app",
      "name": "[concat(parameters('sites_APP_xxxx_xxxx_xxxxx_name'), '/', parameters('slots_prd_name'))]",
      "apiVersion": "2016-08-01",
      "location": "North Europe",
      "scale": null,
      "properties": {
        "enabled": true,
        "hostNameSslStates": [
          {
            "name": "[concat('app-xxxx-xxxx-xxxxx-', parameters('slots_prd_name'),'.azurewebsites.net')]",
            "sslState": "Disabled",
            "virtualIP": null,
            "thumbprint": null,
            "toUpdate": null,
            "hostType": "Standard"
          },
          {
            "name": "[concat('app-xxxx-xxxx-xxxxx-', parameters('slots_prd_name'),'.scm.azurewebsites.net')]",
            "sslState": "Disabled",
            "virtualIP": null,
            "thumbprint": null,
            "toUpdate": null,
            "hostType": "Repository"
          }
        ],
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name'))]",
        "reserved": false,
        "siteConfig": null,
        "scmSiteAlsoStopped": false,
        "hostingEnvironmentProfile": null,
        "clientAffinityEnabled": true,
        "clientCertEnabled": false,
        "hostNamesDisabled": false,
        "containerSize": 0,
        "dailyMemoryTimeQuota": 0,
        "cloningInfo": null,
        "httpsOnly": false
      },
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_APP_xxxx_xxxx_xxxxx_name'))]",
        "[resourceId('Microsoft.Web/serverfarms', parameters('serverfarms_APP_PLAN_xxxx_xxxx_xxxxx_name'))]"
      ]
    },
    {
      "type": "Microsoft.Web/sites/slots/config",
      "name": "[concat(parameters('sites_APP_xxxx_xxxx_xxxxx_name'), '/', parameters('slots_prd_name'), '/', parameters('config_web_name_1'))]",
      "apiVersion": "2016-08-01",
      "location": "North Europe",
      "scale": null,
      "properties": {
        "numberOfWorkers": 1,
        "defaultDocuments": [
          "Default.htm",
          "Default.html",
          "Default.asp",
          "index.htm",
          "index.html",
          "iisstart.htm",
          "default.aspx",
          "index.php",
          "hostingstart.html"
        ],
        "netFrameworkVersion": "v4.0",
        "phpVersion": "5.6",
        "pythonVersion": "",
        "nodeVersion": "",
        "linuxFxVersion": "",
        "windowsFxVersion": null,
        "requestTracingEnabled": false,
        "remoteDebuggingEnabled": false,
        "remoteDebuggingVersion": "VS2017",
        "httpLoggingEnabled": false,
        "logsDirectorySizeLimit": 35,
        "detailedErrorLoggingEnabled": false,
        "publishingUsername": "$app-xxxx-xxxx-xxxxx__prd",
        "publishingPassword": null,
        "appSettings": null,
        "azureStorageAccounts": {},
        "metadata": null,
        "connectionStrings": null,
        "machineKey": null,
        "handlerMappings": null,
        "documentRoot": null,
        "scmType": "None",
        "use32BitWorkerProcess": true,
        "webSocketsEnabled": false,
        "alwaysOn": false,
        "javaVersion": null,
        "javaContainer": null,
        "javaContainerVersion": null,
        "appCommandLine": "",
        "managedPipelineMode": "Integrated",
        "virtualApplications": [
          {
            "virtualPath": "/",
            "physicalPath": "site\\wwwroot",
            "preloadEnabled": false,
            "virtualDirectories": null
          }
        ],
        "winAuthAdminState": 0,
        "winAuthTenantState": 0,
        "customAppPoolIdentityAdminState": false,
        "customAppPoolIdentityTenantState": false,
        "runtimeADUser": null,
        "runtimeADUserPassword": null,
        "loadBalancing": "LeastRequests",
        "routingRules": [],
        "experiments": {
          "rampUpRules": []
        },
        "limits": null,
        "autoHealEnabled": false,
        "autoHealRules": null,
        "tracingOptions": null,
        "vnetName": "",
        "siteAuthEnabled": false,
        "siteAuthSettings": {
          "enabled": null,
          "unauthenticatedClientAction": null,
          "tokenStoreEnabled": null,
          "allowedExternalRedirectUrls": null,
          "defaultProvider": null,
          "clientId": null,
          "clientSecret": null,
          "clientSecretCertificateThumbprint": null,
          "issuer": null,
          "allowedAudiences": null,
          "additionalLoginParams": null,
          "isAadAutoProvisioned": false,
          "googleClientId": null,
          "googleClientSecret": null,
          "googleOAuthScopes": null,
          "facebookAppId": null,
          "facebookAppSecret": null,
          "facebookOAuthScopes": null,
          "twitterConsumerKey": null,
          "twitterConsumerSecret": null,
          "microsoftAccountClientId": null,
          "microsoftAccountClientSecret": null,
          "microsoftAccountOAuthScopes": null
        },
        "cors": null,
        "push": null,
        "apiDefinition": null,
        "autoSwapSlotName": null,
        "localMySqlEnabled": false,
        "managedServiceIdentityId": null,
        "xManagedServiceIdentityId": null,
        "ipSecurityRestrictions": null,
        "scmIpSecurityRestrictions": null,
        "scmIpSecurityRestrictionsUseMain": null,
        "http20Enabled": false,
        "minTlsVersion": "1.2",
        "ftpsState": "AllAllowed",
        "reservedInstanceCount": 0
      },
      "dependsOn": [
        "[resourceId('Microsoft.Web/sites', parameters('sites_APP_xxxx_xxxx_xxxxx_name'))]",
        "[resourceId('Microsoft.Web/sites/slots', parameters('sites_APP_xxxx_xxxx_xxxxx_name'), parameters('slots_prd_name'))]"
      ]
    }
  ]
}
